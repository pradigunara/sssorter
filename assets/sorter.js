var picSet1 = {
  SeoYeon:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/b9f13402-18a4-485b-554c-5b588feb7300/original",
  HyeRin:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/8c88fe6f-954e-4b28-c2a0-e6cf07521e00/original",
  JiWoo:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/af162606-1841-46d7-4a90-a9abbc213200/original",
  ChaeYeon:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/ce9d90fe-3fa2-41c7-5797-529b92653000/original",
  YooYeon:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/10080218-ef3f-43a1-f06c-d1353484c800/original",
  SooMin:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/29c5c317-f39e-41c4-03cb-3f6cca80df00/original",
  NaKyoung:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/9f3cd777-3433-4d77-316c-882a799bbe00/original",
  YuBin:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/22d1e40b-6e5d-4155-61d9-60f47c80a100/original",
  Kaede:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/9a8b8697-ac1f-44e8-f6e7-c5084602fd00/original",
  DaHyun:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/4e8b02af-3cd6-4184-5883-11e54b95ac00/original",
  Kotone:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/eb821ff2-7401-41b0-809e-0cbeaa7df500/original",
  YeonJi:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/a1cfbfac-94ba-4c2f-34c6-82bff903a300/original",
  Nien: "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/d4a5b1dc-d918-424a-bb4c-dae62faa6f00/original",
  SoHyun:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/6407890d-3ab1-42b1-7af0-283300fde500/original",
  Xinyu:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/e8826f78-eb6d-4851-9306-b8d1ffffc900/original",
  Mayu: "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/b70df604-2f72-4edc-6559-25e1f5722700/original",
  Lynn: "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/ec70e985-6a6c-4b41-1f4e-b5e24cb9af00/original",
  JooBin:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/fb9fc551-7374-4074-152a-11e5e5e6dd00/original",
  HaYeon:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/965dbe53-0eac-4958-6301-965e24cd9a00/original",
  ShiOn:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/cb16adf0-b131-4a53-eea1-6644b94ec500/original",
  ChaeWon:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/e3bc62ed-6fed-4f1e-8fc7-334f6f5d4400/original",
  Sullin:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/dcd6973f-dd24-4f3c-bbec-17faa7b26f00/original",
  SeoAh:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/b419c196-d26a-4c12-3b48-39b3a48f8100/original",
  JiYeon:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/22959ee2-1335-4778-2e74-210b06924a00/original",
};

var picSet2 = {
  SeoYeon:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/d580d2ed-c6f1-4bef-09dd-281bd814bd00/original",
  HyeRin:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/cf488c95-e91f-439e-932f-13c8e0f8bf00/original",
  JiWoo:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/7f2e55fb-1df7-46e5-3d33-69d559b2a100/original",
  ChaeYeon:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/b60abba6-87fa-43e2-494d-8eb30b927400/original",
  YooYeon:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/d4fa74bf-db9a-44c7-1261-3bd649473600/original",
  SooMin:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/d21b77ee-38b5-4cdd-74c5-6643eb13ce00/original",
  NaKyoung:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/5a90bde2-5b75-4979-1aae-f9a0e2277500/original",
  YuBin:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/24f5e2c6-0a32-432c-8455-67655e44de00/original",
  Kaede:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/5b020d33-324b-497e-f3a3-dbab65eb8d00/original",
  DaHyun:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/69057e8a-397c-4fed-4328-09b41dda6100/original",
  Kotone:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/24c0bdfd-777b-41b1-93cb-fa921b634500/original",
  YeonJi:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/d905345b-3010-40ad-d01b-5ca2f1018900/original",
  Nien: "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/543b8d71-998a-4799-df8e-1d8b41656500/original",
  SoHyun:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/06bde33a-ccdd-4506-ba26-b94c7f2fc100/original",
  Xinyu:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/8d3b51eb-96b5-477f-5751-607d103d4100/original",
  Mayu: "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/faa5db7a-3ea9-4549-87bb-fa66383edc00/original",
  Lynn: "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/89513af8-89c2-4216-b056-3f9233f6cb00/original",
  JooBin:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/fde6b324-760b-4748-5212-05b004560200/original",
  HaYeon:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/c2f672db-b2f2-451a-0b95-a57ad51cde00/original",
  ShiOn:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/4cde8e25-0180-4285-b453-c3cc2a0a5400/original",
  ChaeWon:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/ce0e07ec-5b2f-41a4-4103-ca5d9e29a100/original",
  Sullin:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/be1f3d9e-36e1-4938-da22-558d64726a00/original",
  SeoAh:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/05320a21-5c63-48e9-9c1b-e2bcc7588c00/original",
  JiYeon:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/6be4886d-0186-479f-0267-8402eeb15200/original",
};

var picSet3 = {
  SeoYeon:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/95225a9a-4246-4fc3-0226-2014f72d2200/original",
  HyeRin:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/011f2101-cbde-4adf-f693-ca6739075900/original",
  JiWoo:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/c01b96a9-d57b-4f11-54d4-d061fb261500/original",
  ChaeYeon:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/9c7682b3-5080-467e-5dd0-6a83dceaf300/original",
  YooYeon:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/781b2067-f443-4ce1-59f6-1e3c9457be00/original",
  SooMin:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/09633460-cfc3-48bf-ec30-c137612a5500/original",
  NaKyoung:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/8c73b365-d3f2-49ef-7c06-fde30b86e100/original",
  YuBin:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/64656d1b-1514-43ae-26da-5062a6bc5300/original",
  Kaede:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/b446221f-b009-4af7-5607-78140db34100/original",
  DaHyun:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/fbb32d81-b4ca-45ab-1a04-892808309300/original",
  Kotone:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/99b88ecf-fe8d-4f93-0ceb-660d12851500/original",
  YeonJi:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/8feab450-6728-4a88-0316-79236fbaea00/original",
  Nien: "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/8d29d6ea-f16f-4271-6169-f8c866854600/original",
  SoHyun:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/561eac9f-cfbf-4f31-280e-75e53992c600/original",
  Xinyu:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/d431e9c1-aeac-44b9-d51a-ff7a92526d00/original",
  Mayu: "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/0aa19b16-0f69-44f0-7579-a14c68e5a300/original",
  Lynn: "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/383ac08a-5864-4263-2de1-785d12ccdf00/original",
  JooBin:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/5174eb1e-16bb-40e9-6e09-351e70dcc600/original",
  HaYeon:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/d9fa1a39-2d4d-41a5-c9c5-b501899a4e00/original",
  ShiOn:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/bbee743b-485e-4db0-917e-ef5c5a343700/original",
  ChaeWon:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/f69d3762-0b36-43e4-e9a3-cf5a60844700/original",
  Sullin:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/bbad2ae3-9fd3-43d6-cf0f-b0315840ba00/original",
  SeoAh:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/2b73cb87-2422-4ec9-05a0-6c3ecbbf1400/original",
  JiYeon:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/ec61e4bc-19ef-492a-3ad0-6be73213fd00/original",
};

var rand = (min, max) => Math.floor(Math.random() * (max - min + 1) + min);
var memberPicId = [picSet1, picSet2, picSet3][rand(0, 2)];

var memberColor = {
  SeoYeon: "#21AEFE",
  HyeRin: "#830CE8",
  JiWoo: "#FDF70A",
  ChaeYeon: "#98C64A",
  YooYeon: "#DC0B74",
  SooMin: "#F985A4",
  NaKyoung: "#659AA0",
  YuBin: "#FDE4E0",
  Kaede: "#FDB634",
  DaHyun: "#FE9BD6",
  Kotone: "#E3C500",
  YeonJi: "#5974FA",
  Nien: "#FD963D",
  SoHyun: "#1223B2",
  Xinyu: "#CA1E20",
  Mayu: "#FB9074",
  Lynn: "#AC60B8",
  JooBin: "#B7F54C",
  HaYeon: "#52D8BB",
  ShiOn: "#FF428A",
  ChaeWon: "#C3A4E0",
  Sullin: "#7DBA8D",
  SeoAh: "#D0F3FF",
  JiYeon: "#FFAB64",
};

var memberEmoji = {
  SeoYeon: "🐶",
  HyeRin: "🐱",
  JiWoo: "🐻",
  ChaeYeon: "🦌",
  YooYeon: "🐰",
  SooMin: "🐿️",
  NaKyoung: "🐈",
  YuBin: "🐯",
  Kaede: "🍁",
  DaHyun: "🍒",
  Kotone: "🦭",
  YeonJi: "🦆",
  Nien: "🐑",
  SoHyun: "🐺",
  Xinyu: "🦊",
  Mayu: "🐇",
  Lynn: "🦈",
  JooBin: "🐣",
  HaYeon: "🐹",
  ShiOn: "🍞",
  ChaeWon: "🎀",
  Sullin: "⛄️",
  SeoAh: "☀️",
  JiYeon: "🦢",
};

var namMember = new Array(
  "SeoYeon",
  "HyeRin",
  "JiWoo",
  "ChaeYeon",
  "YooYeon",
  "SooMin",
  "NaKyoung",
  "YuBin",
  "Kaede",
  "DaHyun",
  "Kotone",
  "YeonJi",
  "Nien",
  "SoHyun",
  "Xinyu",
  "Mayu",
  "Lynn",
  "JooBin",
  "HaYeon",
  "ShiOn",
  "ChaeWon",
  "Sullin",
  "SeoAh",
  "JiYeon",
);

var lstMember = new Array();
var parent = new Array();
var equal = new Array();
var rec = new Array();
var cmp1, cmp2;
var head1, head2;
var nrec;
var numQuestion;
var totalSize;
var finishSize;
var finishFlag;

function initList() {
  const memEmojis = Object.values(memberEmoji);
  const topEmojis = memEmojis.slice(0, 12).join(" ");
  const botEmojis = memEmojis.slice(12).join(" ");
  document.getElementById("member-emojis").innerHTML =
    `${topEmojis}<br/>${botEmojis}`;
  namMember.sort(() => 0.5 - Math.random());

  var n = 0;
  var mid;
  var i;

  lstMember[n] = new Array();

  for (i = 0; i < namMember.length; i++) {
    lstMember[n][i] = i;
  }

  parent[n] = -1;
  totalSize = 0;
  n++;

  for (i = 0; i < lstMember.length; i++) {
    if (lstMember[i].length >= 2) {
      mid = Math.ceil(lstMember[i].length / 2);
      lstMember[n] = new Array();
      lstMember[n] = lstMember[i].slice(0, mid);
      totalSize += lstMember[n].length;
      parent[n] = i;
      n++;
      lstMember[n] = new Array();
      lstMember[n] = lstMember[i].slice(mid, lstMember[i].length);
      totalSize += lstMember[n].length;
      parent[n] = i;
      n++;
    }
  }

  for (i = 0; i < namMember.length; i++) {
    rec[i] = 0;
  }

  nrec = 0;

  for (i = 0; i <= namMember.length; i++) {
    equal[i] = -1;
  }

  cmp1 = lstMember.length - 2;
  cmp2 = lstMember.length - 1;
  head1 = 0;
  head2 = 0;
  numQuestion = 1;
  finishSize = 0;
  finishFlag = 0;
}

function sortList(flag) {
  var i;
  var str;

  if (flag < 0) {
    rec[nrec] = lstMember[cmp1][head1];
    head1++;
    nrec++;
    finishSize++;

    while (equal[rec[nrec - 1]] != -1) {
      rec[nrec] = lstMember[cmp1][head1];
      head1++;
      nrec++;
      finishSize++;
    }
  } else if (flag > 0) {
    rec[nrec] = lstMember[cmp2][head2];
    head2++;
    nrec++;
    finishSize++;

    while (equal[rec[nrec - 1]] != -1) {
      rec[nrec] = lstMember[cmp2][head2];
      head2++;
      nrec++;
      finishSize++;
    }
  } else {
    rec[nrec] = lstMember[cmp1][head1];
    head1++;
    nrec++;
    finishSize++;
    while (equal[rec[nrec - 1]] != -1) {
      rec[nrec] = lstMember[cmp1][head1];
      head1++;
      nrec++;
      finishSize++;
    }
    equal[rec[nrec - 1]] = lstMember[cmp2][head2];
    rec[nrec] = lstMember[cmp2][head2];
    head2++;
    nrec++;
    finishSize++;
    while (equal[rec[nrec - 1]] != -1) {
      rec[nrec] = lstMember[cmp2][head2];
      head2++;
      nrec++;
      finishSize++;
    }
  }

  if (head1 < lstMember[cmp1].length && head2 == lstMember[cmp2].length) {
    while (head1 < lstMember[cmp1].length) {
      rec[nrec] = lstMember[cmp1][head1];
      head1++;
      nrec++;
      finishSize++;
    }
  } else if (
    head1 == lstMember[cmp1].length &&
    head2 < lstMember[cmp2].length
  ) {
    while (head2 < lstMember[cmp2].length) {
      rec[nrec] = lstMember[cmp2][head2];
      head2++;
      nrec++;
      finishSize++;
    }
  }

  if (head1 == lstMember[cmp1].length && head2 == lstMember[cmp2].length) {
    for (i = 0; i < lstMember[cmp1].length + lstMember[cmp2].length; i++) {
      lstMember[parent[cmp1]][i] = rec[i];
    }

    lstMember.pop();
    lstMember.pop();
    cmp1 = cmp1 - 2;
    cmp2 = cmp2 - 2;
    head1 = 0;
    head2 = 0;

    if (head1 == 0 && head2 == 0) {
      for (i = 0; i < namMember.length; i++) {
        rec[i] = 0;
      }
      nrec = 0;
    }
  }

  if (cmp1 < 0) {
    str =
      "Round " +
      (numQuestion - 1) +
      " (" +
      Math.floor((finishSize * 100) / totalSize) +
      "% complete)";
    document.getElementById("battleNumber").innerHTML = str;
    showResult();
    finishFlag = 1;
  } else {
    showFinal();
  }
}

function showResult() {
  var ranking = 1;
  var sameRank = 1;
  var str = "";
  var i;
  var listResult = [];

  str += "<div class='results-list'><h2>Bias Ranking Result</h2><ul>";
  for (i = 0; i < namMember.length; i++) {
    const mem = namMember[lstMember[0][i]];
    const disp = `${mem}${memberEmoji[mem]}`;
    listResult.push(disp);

    str += "<li><span class='number'>" + ranking + "</span> " + disp + "</li>";

    if (i < namMember.length - 1) {
      if (equal[lstMember[0][i]] == lstMember[0][i + 1]) {
        sameRank++;
      } else {
        ranking += sameRank;
        sameRank = 1;
      }
    }
  }

  str += "</ul>";
  document.getElementById("battleResult").innerHTML = str;
  document.getElementById("page-sorter").style.display = "none";

  const shareText = `My %23tripleS Bias Ranking:%0A${listResult.join("%0A")}%0A> https://sssorter.pages.dev`;
  const tweetBtn = document.getElementById("tweet-button");
  tweetBtn.style.display = "inline";
  tweetBtn.href = `https://twitter.com/intent/tweet?text=${shareText}`;
}

function showFinal() {
  var str0 =
    "Round " +
    numQuestion +
    " (" +
    Math.floor((finishSize * 100) / totalSize) +
    "% complete)";
  var str1 = "" + toNameFace(lstMember[cmp1][head1]);
  var str2 = "" + toNameFace(lstMember[cmp2][head2]);

  document.getElementById("battleNumber").innerHTML = str0;
  document.getElementById("optionA").innerHTML = str1;
  document.getElementById("optionB").innerHTML = str2;
  numQuestion++;
}

function toNameFace(n) {
  const mem = namMember[n];
  const disp = `<div>
  <span style='color:${memberColor[mem]};text-shadow: 1px 2px #808080;'>${mem}</span><br><span>${memberEmoji[mem] || ""}</span> 
  <img src='${memberPicId[mem]}' style='max-height:100%;max-width:100%'/>
</div>`;

  return disp;
}
