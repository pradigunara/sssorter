var picSet1 = {
  SeoYeon:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/c8eaea61-ae6f-4a58-e4e1-ca1d4a972e00/2x",
  HyeRin:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/4ccc472d-b24b-45f9-0d8a-45e35bf19700/2x",
  JiWoo:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/1b64eca0-d460-44c6-da8c-bdf04473c300/2x",
  ChaeYeon:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/f1e8add6-9449-467c-cc47-a51774243400/2x",
  YooYeon:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/29428ed2-3e41-483f-cb52-33b20cb4fa00/2x",
  SooMin:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/914dba60-68ca-4ad7-548e-67f224619500/2x",
  NaKyoung:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/df5f7323-185d-411c-1ade-a97042fd0500/2x",
  YuBin:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/582ffc1a-c494-4d54-f48a-348b3f205000/2x",
  Kaede:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/237fedd1-1aea-41df-05ae-e9e116ae7500/2x",
  DaHyun:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/0c5094c9-fbf9-4fa5-147a-c4ced825e900/2x",
  Kotone:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/a24336bd-2b4d-4842-a7c5-8e0248c08d00/2x",
  YeonJi:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/8bfecaf0-02e4-481c-8e2c-0318803ed700/2x",
  Nien: "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/e79961b2-5f56-41d5-c248-04fa76f76000/2x",
  SoHyun:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/745a2808-af21-47d0-eea1-be71718c2600/2x",
  Xinyu:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/3d89bd5e-222f-4ef3-0ffd-6e38cd803800/2x",
  Mayu: "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/5c230d04-159e-42fd-4ffe-e629c7373d00/2x",
  Lynn: "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/85327937-56d8-4ad4-c4cd-45778199bd00/2x",
  JooBin:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/3170e480-0e08-4e2a-3539-083241633100/2x",
  HaYeon:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/ecc6f3eb-ebf0-4be1-dccd-c7b96f7dd200/2x",
  ShiOn:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/d6134145-d125-4cde-7ed9-13f36e5bba00/2x",
  ChaeWon:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/79ec0b28-e63e-4657-f446-a32f55167000/2x",
  Sullin:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/fe379953-8684-49b4-2fae-98968c018900/2x",
  SeoAh:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/e4ac2f4e-08db-4204-f203-29c769d58200/2x",
  JiYeon:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/65fc5834-91da-4f5f-456f-ffa75c9aa300/2x",
};

var picSet2 = {
  SeoYeon:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/8911a1cd-cba8-43eb-18e3-92536de92a00/2x",
  HyeRin:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/24e537f2-9936-4b32-1994-30efad8c8a00/2x",
  JiWoo:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/28a49277-ed8e-40ed-864a-7fb7ef128d00/2x",
  ChaeYeon:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/9f0dca17-1827-47cd-0440-e6b6e0f67900/2x",
  YooYeon:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/3b21ec45-02ee-40fc-78c6-888dd7e5d800/2x",
  SooMin:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/e238fe9f-1753-4114-140b-aeac40df3100/2x",
  NaKyoung:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/ec3354ea-2dc2-4d6c-5037-93cb520b5000/2x",
  YuBin:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/59537afd-0ef3-4f92-af98-41e242828000/2x",
  Kaede:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/68fae808-9aca-4518-2a03-c94d4a2c5f00/2x",
  DaHyun:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/7b0bd21a-1643-487e-aa6a-76380f47a100/2x",
  Kotone:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/086fb95c-6135-4afc-6fd1-cdced86e9d00/2x",
  YeonJi:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/d9cd50d2-d266-4c89-e4fd-c5ce0707b100/2x",
  Nien: "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/8532c958-b11a-4bfd-1e37-54d762d72700/2x",
  SoHyun:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/d71a1f4b-90e0-4a5f-7411-2aa560197f00/2x",
  Xinyu:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/2870bbcd-5639-4404-cda8-056cdf04bf00/2x",
  Mayu: "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/6b0fb3e8-7cfc-444d-cc64-b2f61c9b6800/2x",
  Lynn: "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/94e1a74b-1f8f-4886-c402-809e14eb1900/2x",
  JooBin:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/4580d694-4bc1-45df-16f1-ee8cc8d8d300/2x",
  HaYeon:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/c3f08392-d51d-4b9b-ade3-6626ead20900/2x",
  ShiOn:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/7c49e490-445e-4170-4c78-7415dd7f9000/2x",
  ChaeWon:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/cb9e5e39-3552-47cc-8afa-a853be520600/2x",
  Sullin:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/c30fde2f-2adb-410c-15ef-0fb6bcc37c00/2x",
  SeoAh:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/9d48c0e3-57d4-42e6-bf0e-523f6b923b00/2x",
  JiYeon:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/8f765952-216e-44fc-1bd3-f0df40dea600/2x",
};

var picSet3 = {
  SeoYeon:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/64b04454-3acd-4d27-b040-604f664d0500/2x",
  HyeRin:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/52c1c9da-63d3-4aca-8812-a4a74e9d0600/2x",
  JiWoo:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/76604ad2-8d82-464d-b71c-7bf3350a5200/2x",
  ChaeYeon:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/1494a5ef-746b-4c73-6149-8858db2a6900/2x",
  YooYeon:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/74e57513-d55c-414b-47d9-e4fbce23a400/2x",
  SooMin:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/df583aa7-792d-49ca-b575-a6e568f92d00/2x",
  NaKyoung:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/0d2138b5-f26b-4095-ec18-f4a74cbe8500/2x",
  YuBin:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/f06459a0-42a9-48a1-b423-4d7894052000/2x",
  Kaede:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/4c0780c9-a492-415b-8886-5bad283af500/2x",
  DaHyun:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/15bc6da3-275b-42f5-d96e-b7b90a21a800/2x",
  Kotone:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/8ad8bedb-5ec8-4ecc-0651-81f39d292800/2x",
  YeonJi:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/758979cd-3312-400f-0182-3fb8a87bd800/2x",
  Nien: "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/aa96fc5c-5bfd-42ea-bfd8-f81ca568b800/2x",
  SoHyun:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/5b7be708-aeb2-47b3-6e9c-ed711602e900/2x",
  Xinyu:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/f1c0966b-b6fa-4125-7b5d-ce04c91b2d00/2x",
  Mayu: "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/2e1ad6b9-3eff-4c04-3eba-c00d5f68b100/2x",
  Lynn: "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/fbb280ec-e19e-4ff4-9edb-776733ecd900/2x",
  JooBin:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/4c121d16-546f-4c44-8f5c-5e648433ce00/2x",
  HaYeon:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/030128b0-f966-45c5-f2b8-418413f73400/2x",
  ShiOn:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/dc5582f1-757b-4525-2520-dfc4d1231100/2x",
  ChaeWon:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/c284da64-cc96-4457-6a86-f884749be000/2x",
  Sullin:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/14dcb152-6a07-4551-ed2a-8107934bae00/2x",
  SeoAh:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/55460669-7972-49f6-4493-2a977f57b600/2x",
  JiYeon:
    "https://imagedelivery.net/qQuMkbHJ-0s6rwu8vup_5w/1f31faa4-9df2-4a84-7b02-58ed91288d00/2x",
};

var rand = (min, max) => Math.floor(Math.random() * (max - min + 1) + min);
var memberPicId = [picSet1, picSet2, picSet3][rand(0, 2)];

var memberColor = {
  SeoYeon: "#21AEFE",
  HyeRin: "#830CE8",
  JiWoo: "#FDF70A",
  ChaeYeon: "#98C64A",
  YooYeon: "#DC0B74",
  SooMin: "#F985A4",
  NaKyoung: "#659AA0",
  YuBin: "#FDE4E0",
  Kaede: "#FDB634",
  DaHyun: "#FE9BD6",
  Kotone: "#E3C500",
  YeonJi: "#5974FA",
  Nien: "#FD963D",
  SoHyun: "#1223B2",
  Xinyu: "#CA1E20",
  Mayu: "#FB9074",
  Lynn: "#AC60B8",
  JooBin: "#B7F54C",
  HaYeon: "#52D8BB",
  ShiOn: "#FF428A",
  ChaeWon: "#C3A4E0",
  Sullin: "#7DBA8D",
  SeoAh: "#D0F3FF",
  JiYeon: "#FFAB64",
};

var memberEmoji = {
  SeoYeon: "ğŸ¶",
  HyeRin: "ğŸ±",
  JiWoo: "ğŸ»",
  ChaeYeon: "ğŸ¦Œ",
  YooYeon: "ğŸ°",
  SooMin: "ğŸ¿ï¸",
  NaKyoung: "ğŸˆ",
  YuBin: "ğŸ¯",
  Kaede: "ğŸ",
  DaHyun: "ğŸ’",
  Kotone: "ğŸ¦­",
  YeonJi: "ğŸ¦†",
  Nien: "ğŸ‘",
  SoHyun: "ğŸº",
  Xinyu: "ğŸ¦Š",
  Mayu: "ğŸ‡",
  Lynn: "ğŸ¦ˆ",
  JooBin: "ğŸ£",
  HaYeon: "ğŸ¹",
  ShiOn: "ğŸ",
  ChaeWon: "ğŸ€",
  Sullin: "â›„ï¸",
  SeoAh: "â˜€ï¸",
  JiYeon: "ğŸ¦¢",
};

var namMember = new Array(
  "SeoYeon",
  "HyeRin",
  "JiWoo",
  "ChaeYeon",
  "YooYeon",
  "SooMin",
  "NaKyoung",
  "YuBin",
  "Kaede",
  "DaHyun",
  "Kotone",
  "YeonJi",
  "Nien",
  "SoHyun",
  "Xinyu",
  "Mayu",
  "Lynn",
  "JooBin",
  "HaYeon",
  "ShiOn",
  "ChaeWon",
  "Sullin",
  "SeoAh",
  "JiYeon",
);

var lstMember = new Array();
var parent = new Array();
var equal = new Array();
var rec = new Array();
var cmp1, cmp2;
var head1, head2;
var nrec;
var numQuestion;
var totalSize;
var finishSize;
var finishFlag;

function initList() {
  const memEmojis = Object.values(memberEmoji);
  const topEmojis = memEmojis.slice(0, 12).join(" ");
  const botEmojis = memEmojis.slice(12).join(" ");
  document.getElementById("member-emojis").innerHTML =
    `${topEmojis}<br/>${botEmojis}`;
  namMember.sort(() => 0.5 - Math.random());

  var n = 0;
  var mid;
  var i;

  lstMember[n] = new Array();

  for (i = 0; i < namMember.length; i++) {
    lstMember[n][i] = i;
  }

  parent[n] = -1;
  totalSize = 0;
  n++;

  for (i = 0; i < lstMember.length; i++) {
    if (lstMember[i].length >= 2) {
      mid = Math.ceil(lstMember[i].length / 2);
      lstMember[n] = new Array();
      lstMember[n] = lstMember[i].slice(0, mid);
      totalSize += lstMember[n].length;
      parent[n] = i;
      n++;
      lstMember[n] = new Array();
      lstMember[n] = lstMember[i].slice(mid, lstMember[i].length);
      totalSize += lstMember[n].length;
      parent[n] = i;
      n++;
    }
  }

  for (i = 0; i < namMember.length; i++) {
    rec[i] = 0;
  }

  nrec = 0;

  for (i = 0; i <= namMember.length; i++) {
    equal[i] = -1;
  }

  cmp1 = lstMember.length - 2;
  cmp2 = lstMember.length - 1;
  head1 = 0;
  head2 = 0;
  numQuestion = 1;
  finishSize = 0;
  finishFlag = 0;
}

function sortList(flag) {
  var i;
  var str;

  if (flag < 0) {
    rec[nrec] = lstMember[cmp1][head1];
    head1++;
    nrec++;
    finishSize++;

    while (equal[rec[nrec - 1]] != -1) {
      rec[nrec] = lstMember[cmp1][head1];
      head1++;
      nrec++;
      finishSize++;
    }
  } else if (flag > 0) {
    rec[nrec] = lstMember[cmp2][head2];
    head2++;
    nrec++;
    finishSize++;

    while (equal[rec[nrec - 1]] != -1) {
      rec[nrec] = lstMember[cmp2][head2];
      head2++;
      nrec++;
      finishSize++;
    }
  } else {
    rec[nrec] = lstMember[cmp1][head1];
    head1++;
    nrec++;
    finishSize++;
    while (equal[rec[nrec - 1]] != -1) {
      rec[nrec] = lstMember[cmp1][head1];
      head1++;
      nrec++;
      finishSize++;
    }
    equal[rec[nrec - 1]] = lstMember[cmp2][head2];
    rec[nrec] = lstMember[cmp2][head2];
    head2++;
    nrec++;
    finishSize++;
    while (equal[rec[nrec - 1]] != -1) {
      rec[nrec] = lstMember[cmp2][head2];
      head2++;
      nrec++;
      finishSize++;
    }
  }

  if (head1 < lstMember[cmp1].length && head2 == lstMember[cmp2].length) {
    while (head1 < lstMember[cmp1].length) {
      rec[nrec] = lstMember[cmp1][head1];
      head1++;
      nrec++;
      finishSize++;
    }
  } else if (
    head1 == lstMember[cmp1].length &&
    head2 < lstMember[cmp2].length
  ) {
    while (head2 < lstMember[cmp2].length) {
      rec[nrec] = lstMember[cmp2][head2];
      head2++;
      nrec++;
      finishSize++;
    }
  }

  if (head1 == lstMember[cmp1].length && head2 == lstMember[cmp2].length) {
    for (i = 0; i < lstMember[cmp1].length + lstMember[cmp2].length; i++) {
      lstMember[parent[cmp1]][i] = rec[i];
    }

    lstMember.pop();
    lstMember.pop();
    cmp1 = cmp1 - 2;
    cmp2 = cmp2 - 2;
    head1 = 0;
    head2 = 0;

    if (head1 == 0 && head2 == 0) {
      for (i = 0; i < namMember.length; i++) {
        rec[i] = 0;
      }
      nrec = 0;
    }
  }

  if (cmp1 < 0) {
    str =
      "Round " +
      (numQuestion - 1) +
      " (" +
      Math.floor((finishSize * 100) / totalSize) +
      "% complete)";
    document.getElementById("battleNumber").innerHTML = str;
    showResult();
    finishFlag = 1;
  } else {
    showFinal();
  }
}

function showResult({ full = false } = {}) {
  var ranking = 1;
  var sameRank = 1;
  var str = "";
  var i;
  var listResult = [];

  var iterCount = full ? namMember.length : namMember.length / 2;

  str += "<div class='results-list'><h2>Bias Ranking Result</h2><ul>";
  for (i = 0; i < iterCount; i++) {
    const mem = namMember[lstMember[0][i]];
    const disp = `${mem}${memberEmoji[mem]}`;
    listResult.push(disp);

    str += "<li><span class='number'>" + ranking + "</span> " + disp + "</li>";

    if (i < iterCount - 1) {
      if (equal[lstMember[0][i]] == lstMember[0][i + 1]) {
        sameRank++;
      } else {
        ranking += sameRank;
        sameRank = 1;
      }
    }
  }

  str += "</ul>";
  document.getElementById("battleResult").innerHTML = str;
  document.getElementById("page-sorter").style.display = "none";

  document.getElementById("showMore").style.display = "inline";

  const shareText = `My %23tripleS Bias Ranking:%0A${listResult.join("%0A")}%0A> https://sssorter.pages.dev`;
  const tweetBtn = document.getElementById("tweet-button");
  tweetBtn.style.display = "inline-block";
  tweetBtn.href = `https://twitter.com/intent/tweet?text=${shareText}`;
}

function toggleResult() {
  const showMoreText = document.getElementById("showMore").innerText;

  if (showMoreText === "Show More") {
    document.getElementById("showMore").innerText = "Show Less";
    showResult({ full: true });
  } else {
    document.getElementById("showMore").innerText = "Show More";
    showResult({ full: false });
  }
}

function showFinal() {
  var str0 =
    "Round " +
    numQuestion +
    " (" +
    Math.floor((finishSize * 100) / totalSize) +
    "% complete)";
  var str1 = "" + toNameFace(lstMember[cmp1][head1]);
  var str2 = "" + toNameFace(lstMember[cmp2][head2]);

  document.getElementById("battleNumber").innerHTML = str0;
  document.getElementById("optionA").innerHTML = str1;
  document.getElementById("optionB").innerHTML = str2;
  numQuestion++;
}

function toNameFace(n) {
  const mem = namMember[n];
  const disp = `<div>
  <span style='color:${memberColor[mem]};text-shadow: 1px 2px #808080;'>${mem}</span><br><span>${memberEmoji[mem] || ""}</span> 
  <img src='${memberPicId[mem]}' style='max-height:100%;max-width:100%'/>
</div>`;

  return disp;
}
